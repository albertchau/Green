/*! bootstrap-calendar 2013-03-24 */
"use strict";Date.prototype.getWeek=function(){var t=new Date(this.getFullYear(),0,1);return Math.ceil(((this.getTime()-t.getTime())/864e5+t.getDay()+1)/7)},Date.prototype.getMonthFormatted=function(){var t=this.getMonth()+1;return 10>t?"0"+t:t},Date.prototype.getDateFormatted=function(){var t=this.getDate();return 10>t?"0"+t:t},function(t){function e(e){return t.ajaxSetup({dataType:"json",type:"post",async:!1}),n=t.extend(!0,{},a,e),s.css("width",n.width),this.view.call(this),this}var a={width:"100%",view:"month",day:"now",first_day:1,events_url:"",classes:{months:{inmonth:"cal-day-inmonth",outmonth:"cal-day-outmonth",saturday:"cal-day-weekend",sunday:"cal-day-weekend",holidays:"cal-day-holiday",today:"cal-day-today"}},holidays:{"08-03":"International Women's Day","25-12":"Christmass"},onAfterEventsLoad:function(){},onBeforeEventsLoad:function(t){t()},onAfterViewLoad:function(){},events:[],position:{start:new Date,end:new Date},templates:{month:"",week:"",day:""},"break":!1},n={},s=null;e.prototype.render=function(){s.html("Start at: "+n.position.start+"<br> End at: "+n.position.end),s.html(""),this.load_template(),this.break=!1;var t={};switch(t.events=n.events,t.cal=this,t.day=1,t.months=1==n.first_day?[language.d1,language.d2,language.d3,language.d4,language.d5,language.d6,language.d0]:[language.d0,language.d1,language.d2,language.d3,language.d4,language.d5,language.d6],n.view){case"month":break;case"week":break;case"day":}s.append(n.templates[n.view](t)),this.update()},e.prototype._month=function(t){var e=t+1,a=n.position.start.getFullYear()+"-"+(10>e?"0"+e:e)+"-"+"01";return'<span class="pull-right" data-cal-month="'+a+'">'+language["m"+t]+'</span><div class="clearfix"></div><small class="cal-events-num pull-right">19</small>'},e.prototype._day=function(e,a){var s=n.classes.months.outmonth,i="",o=n.position.start.getDay();2==n.first_day&&o++,a=a-o+1;var r=new Date(n.position.start.getFullYear(),n.position.start.getMonth(),a,0,0,0);if(a>0){s=n.classes.months.inmonth;var l=r.getDateFormatted()+"-"+r.getMonthFormatted();t.inArray(l,_.keys(n.holidays))>-1&&(s=n.classes.months.holidays,i=n.holidays[l])}if(a+1>n.position.end.getDate()&&(this.break=!0),a>n.position.end.getDate()&&(a-=n.position.end.getDate(),s=n.classes.months.outmonth),0==r.getDay()&&s==n.classes.months.inmonth&&(s=n.classes.months.sunday),6==r.getDay()&&s==n.classes.months.inmonth&&(s=n.classes.months.saturday),r.toDateString()==(new Date).toDateString()&&(s=n.classes.months.today),0>=a){var d=new Date(n.position.start.getFullYear(),n.position.start.getMonth(),0).getDate();a=d-Math.abs(a),s+=" cal-month-first-row"}var c=r.getFullYear()+"-"+r.getMonthFormatted()+"-"+(10>a?"0"+a:a),h='<div class="cal-month-day '+s+'"><span class="pull-right" data-cal-week-day="'+(r.getDay()+1)+'" data-cal-day="'+c+'"';i&&(h+=' rel="tooltip" data-original-title="'+i+'" '),h+=">"+a+"</span>";var u=parseInt(r.getTime()),g=parseInt(u+86400),m=[];return t.each(n.events,function(t,e){g>=parseInt(e.start)&&parseInt(e.end)>=u&&m.push('<a href="'+e.url+'" data-event-id="'+e.id+'" data-event-class="'+e.class+'" class="pull-left event '+e.class+" event"+e.id+'" rel="tooltip" data-original-title="'+e.title+'"></a>')}),m.length>0&&(h+='<div class="events-list">'+m.join(" ")+"</div>"),h+="</div>"},e.prototype.view=function(t){t&&(n.view=t),this.init_position.call(this),this.load_url.call(this),this.render.call(this),n.onAfterViewLoad.call(this,n.view)},e.prototype.navigate=function(e,a){var s=t.extend({},n.position);if("next"==e)switch(n.view){case"year":s.start.setFullYear(n.position.start.getFullYear()+1);break;case"month":s.start.setMonth(n.position.start.getMonth()+1);break;case"week":s.start.setDate(n.position.start.getDate()+7);break;case"day":s.start.setDate(n.position.start.getDate()+1)}else if("prev"==e)switch(n.view){case"year":s.start.setFullYear(n.position.start.getFullYear()-1);break;case"month":s.start.setMonth(n.position.start.getMonth()-1);break;case"week":s.start.setDate(n.position.start.getDate()-7);break;case"day":s.start.setDate(n.position.start.getDate()-1)}else"today"==e?s.start.setTime((new Date).getTime()):t.error(language.error_where.format(e));n.day=s.start.getFullYear()+"-"+s.start.getMonthFormatted()+"-"+s.start.getDateFormatted(),this.view.call(this),_.isFunction(a)&&a()},e.prototype.init_position=function(){var e,a,s;if("now"==n.day){var i=new Date;e=i.getFullYear(),a=i.getMonth(),s=i.getDate()}else if(n.day.match(/^\d{4}-\d{2}-\d{2}$/g)){var o=n.day.split("-");e=o[0],a=o[1]-1,s=o[2]}else t.error(language.error_dateformat.format(n.day));switch(n.view){case"year":n.position.start.setTime(new Date(e,0,1).getTime()),n.position.end.setTime(new Date(e,12,0,23,59,59).getTime());break;case"month":n.position.start.setTime(new Date(e,a,1).getTime()),n.position.end.setTime(new Date(e,a+1,0,23,59,59).getTime());break;case"day":n.position.start.setTime(new Date(e,a,s).getTime()),n.position.end.setTime(new Date(e,a,s,23,59,59).getTime());break;case"week":var r=new Date(e,a,s),l=r.getDate()-r.getDay();1==n.first_day&&(l+=1);var d=l+6;n.position.start.setTime(new Date(e,a,l).getTime()),n.position.end.setTime(new Date(e,a,d,23,59,59).getTime());break;default:t.error(language.error_noview.format(n.view))}return this},e.prototype.title=function(){var t=n.position.start;switch(n.view){case"year":return language.title_year.format(t.getFullYear());case"month":return language.title_month.format(language["m"+t.getMonth()],t.getFullYear());case"week":return language.title_week.format(t.getWeek(),t.getFullYear());case"day":return language.title_day.format(language["d"+t.getDay()],t.getDate(),language["m"+t.getMonth()],t.getFullYear())}},e.prototype.load_url=function(){n.events_url||t.error(language.error_loadurl),n.onBeforeEventsLoad(function(){t.ajax({url:n.events_url,data:{from:n.position.start.getTime(),to:n.position.end.getTime()}}).done(function(e){e.success||t.error(e.error),n.events=e.result,n.onAfterEventsLoad(e.result)})})},e.prototype.load_template=function(){n.templates[n.view]||t.ajax({url:"tmpls/"+n.view+".html",dataType:"html",type:"GET"}).done(function(t){n.templates[n.view]=_.template(t)})},e.prototype.update=function(){t('*[rel="tooltip"]').tooltip();var e=this;switch(n.view){case"year":t("span[data-cal-month]").each(function(a,s){t(s).click(function(){n.day=t(s).data("cal-month"),e.view("month")})});break;case"month":var a=t(document.createElement("div")).attr("id","cal-week-box");a.html(language.week);var s=n.position.start.getFullYear()+"-"+n.position.start.getMonthFormatted()+"-";t(".cal-month-box .cal-row-fluid").each(function(e,n){var i=t(n);"cal-slide-box"!=i.attr("id")&&i.bind("mouseenter",function(){var e=t(".cal-span1:first-child .cal-month-day",i),n=e.hasClass("cal-month-first-row")?1:t("[data-cal-day]",e).text();n=10>n?"0"+n:n,a.show().attr("data-cal-week",s+n).appendTo(e)}).bind("mouseleave",function(){a.hide()})}),a.click(function(){n.day=t(this).data("cal-week"),e.view("week")}),t("*[data-cal-day]").each(function(a,s){t(s).click(function(){n.day=t(this).data("cal-day"),e.view("day")})}),t(".cal-span1").each(function(a,s){t(s).dblclick(function(){n.day=t("[data-cal-day]",this).data("cal-day"),e.view("day")})});var i=0,o=t(document.createElement("div")).attr("id","cal-day-box").html('<i class="icon-chevron-down"></i>');t(".cal-month-day").each(function(e,a){"cal-slide-box"!=t(a).parents(".cal-row-fluid").attr("id")&&(t(a).bind("mouseenter",function(){0!=t(".events-list",a).length&&t(a).children("[data-cal-day]").text()!=i&&o.show().appendTo(a)}),t(a).bind("mouseleave",function(){o.hide()}))});var r=t(document.createElement("div")).attr("id","cal-slide-box");r.hide().click(function(t){t.stopPropagation()});var l="";t.ajax({url:"tmpls/month-slide.html",dataType:"html",type:"GET"}).done(function(t){l=_.template(t)}),o.click(function(e){e.stopPropagation();var a=t(this),n=t(this).parents(".cal-row-fluid");a.hide();var s=a.parent().children("[data-cal-day]").attr("data-cal-week-day");r.html(l({events:t(".events-list a.event",t(this).parent())})).slideUp("fast",function(){n.after(r),i=a.parent().children("[data-cal-day]").text(),t("#cal-slide-tick").addClass("tick"+s).show(),r.slideDown("fast",function(){t("body").one("click",function(){r.slideUp("fast"),i=0})})}),t("a.event-item").mouseenter(function(){t("a.event"+t(this).data("event-id")).parents(".cal-span1").addClass("day-highlight dh-"+t(this).data("event-class"))}),t("a.event-item").mouseleave(function(){t("div.cal-span1").removeClass("day-highlight dh-"+t(this).data("event-class"))})}),t("a.event").mouseenter(function(){t("a.event"+t(this).data("event-id")).parents(".cal-span1").addClass("day-highlight dh-"+t(this).data("event-class"))}),t("a.event").mouseleave(function(){t("div.cal-span1").removeClass("day-highlight dh-"+t(this).data("event-class"))});break;case"week":break;case"day":}},t.fn.calendar=function(t){return s=this,new e(t)}}(jQuery);